<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <title>拼写任务</title>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    #thanksMessage { display: none; font-weight: bold; color: green; }
  </style>
  <!-- 添加 favicon（可选） -->
  <link rel="icon" href="favicon.ico" type="image/x-icon">
</head>
<body>
  <h1>拼写任务</h1>
  <p>请纠正下面句子的拼写：</p>
  <p><em>"I recieved teh invitaton yestarday."</em></p>

  <form id="taskForm">
    <textarea id="correctedText" rows="4" cols="50" required></textarea><br>
    <button type="submit">提交</button>
  </form>

  <p id="timer"></p>
  <p id="thanksMessage">谢谢！您的回答已提交。</p>

  <!-- Firebase SDKs -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.0.0/firebase-app.js";
    import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore.js";

    // Firebase 配置信息
    const firebaseConfig = {
      apiKey: "AIzaSyA4eqoXelo_GDAB6StRH7iU5HBvlnjqmsc",
      authDomain: "spellingtask.firebaseapp.com",
      projectId: "spellingtask",
      storageBucket: "spellingtask.firebasestorage.app",
      messagingSenderId: "754744794519",
      appId: "1:754744794519:web:57ff06a0114920a9ae78d2",
      measurementId: "G-TKTLNMDVZJ"
    };

    // 初始化 Firebase
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // 开始计时
    const startTime = Date.now();

    // 表单提交事件
    document.getElementById("taskForm").addEventListener("submit", async function(e) {
      e.preventDefault();
      const corrected = document.getElementById("correctedText").value;
      const duration = ((Date.now() - startTime) / 1000).toFixed(2);

      try {
        console.log("提交数据到 Firestore...");

        // 保存数据到 Firestore
        await addDoc(collection(db, "spellingResponses"), {
          correctedText: corrected,
          timeTakenSec: parseFloat(duration),
          timestamp: serverTimestamp()
        });

        console.log("数据成功提交！");

        // 隐藏表单并显示感谢消息
        document.getElementById("taskForm").style.display = "none";
        document.getElementById("thanksMessage").style.display = "block";
        document.getElementById("timer").textContent = "您用了 " + duration + " 秒。";
      } catch (err) {
        console.error("提交数据到 Firestore 时出错: ", err);
        alert("保存数据时发生错误：" + err.message);
      }
    });
  </script>
</body>
</html>
