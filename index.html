<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <title>拼写任务</title>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    #thanksMessage { display: none; font-weight: bold; color: green; }
  </style>
  <link rel="icon" href="favicon.ico" type="image/x-icon">
</head>
<body>
  <h1>拼写任务</h1>
  <div id="taskArea">
    <p id="sentenceDisplay"></p>
    <form id="taskForm">
      <textarea id="correctedText" rows="4" cols="50" required></textarea><br>
      <button type="submit">提交</button>
    </form>
    <p id="timer"></p>
    <p>题目 <span id="questionNumber">1</span> / 20</p>
  </div>

  <p id="thanksMessage">谢谢！您已完成所有题目。</p>

  <!-- Firebase SDK -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.0.0/firebase-app.js";
    import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyA4eqoXelo_GDAB6StRH7iU5HBvlnjqmsc",
      authDomain: "spellingtask.firebaseapp.com",
      projectId: "spellingtask",
      storageBucket: "spellingtask.firebasestorage.app",
      messagingSenderId: "754744794519",
      appId: "1:754744794519:web:57ff06a0114920a9ae78d2",
      measurementId: "G-TKTLNMDVZJ"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const sentences = [
      "I recieved teh invitaton yestarday.",
      "She dont has enogh experince for the job.",
      "We was planing to go on vaccation next week.",
      "The childs was plaing in the gardan.",
      "I haved too much coffee this morning.",
      "He writed the report last night.",
      "There is many reason why it failled.",
      "They has went to the wrong adress.",
      "This is the most bueatiful place I seen.",
      "I hope you enjoi your stay hear.",
      "He don’t know where the libary is.",
      "Their going to the zoo tomorrow.",
      "It’s cold so ware a jacket.",
      "The test was realy difficlt.",
      "I will meat you at the resturant.",
      "We have alot of work too do.",
      "I losted my phone at the park.",
      "Your the best freind I ever had.",
      "She has many knoledg about art.",
      "My favorit color is bleau."
    ];

    let currentIndex = 0;
    let startTime = Date.now();

    const sentenceDisplay = document.getElementById("sentenceDisplay");
    const form = document.getElementById("taskForm");
    const correctedText = document.getElementById("correctedText");
    const timer = document.getElementById("timer");
    const thanksMessage = document.getElementById("thanksMessage");
    const questionNumber = document.getElementById("questionNumber");
    const taskArea = document.getElementById("taskArea");

    function showSentence(index) {
      sentenceDisplay.textContent = `请改写： "${sentences[index]}"`;
      correctedText.value = "";
      questionNumber.textContent = index + 1;
      startTime = Date.now();
    }

    showSentence(currentIndex);

    form.addEventListener("submit", async function(e) {
      e.preventDefault();
      const answer = correctedText.value.trim();
      const duration = ((Date.now() - startTime) / 1000).toFixed(2);
      const original = sentences[currentIndex];

      try {
        await addDoc(collection(db, "spellingResponses"), {
          originalSentence: original,
          correctedText: answer,
          timeTakenSec: parseFloat(duration),
          timestamp: serverTimestamp()
        });
      } catch (err) {
        console.error("提交数据失败:", err);
        alert("提交失败：" + err.message);
        return;
      }

      if (currentIndex < sentences.length - 1) {
        currentIndex++;
        showSentence(currentIndex);
        timer.textContent = "";
      } else {
        //taskArea.style.display = "none";
        //thanksMessage.style.display = "block";
        taskArea.style.display = "none";
        thanksMessage.style.display = "block";

// ✅ 3秒后跳转到 Google 表单页面
setTimeout(() => {
  window.location.href = "https://docs.google.com/forms/d/e/1FAIpQLSccGsHsAy3knhB007yAzRTsaS6OFdPCqS9vhnhyR2Kiz7OIQw/viewform?usp=header";
}, 3000);
      }
    });
  </script>
</body>
</html>
